# source the plugin and add it to fpath
# if needed, clone it first and symlink the init file
local repo="$1"
local plugin_name=${${repo##*/}%.git}
local plugindir="${ZPLUGINDIR:-$ZDOTDIR/plugins}/$plugin_name"

# clone if the plugin isn't there already
if [[ ! -d $plugindir ]]; then
  plugin-clone "https://github.com/${repo}"
fi
if [[ ! -e $plugindir/init.zsh ]]; then
  plugin-initfile $plugindir >/dev/null
  ln -s $REPLY $plugindir/init.zsh
fi
fpath+=$plugindir
if [[ -d $plugindir/functions ]]; then
  fpath+=$plugindir/functions
fi
source $plugindir/init.zsh
