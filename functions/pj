# PJ: Project jumper
if ! command -v fzf >/dev/null; then
  echo "fzf command not found" >&2
  return 1
fi

# determine the project home
local prjhome
if [[ -n "$1" ]]; then
  prjhome="${1:a}"
else
  prjhome=${XDG_PROJECTS_DIR:-$HOME/Projects}
fi

if [[ ! -d $prjhome ]]; then
    echo "Project home directory not found: $prjhome" >&2
    return 1
fi

local projects=()
local p
for p in $prjhome/**/.git; do
  projects+=${${p:h}#*$prjhome/}
done

# fzf a project
local selection=$(echo $projects | tr ' ' '\n' | fzf --layout=reverse-list)

# cd to the selected project
if [[ -n $selection ]] && [[ -d $prjhome/$selection ]]; then
  cd $prjhome/$selection
fi
